# AI功能集成测试说明

## 已完成的修改

### 1. 新增文件
- `Packages/HamsterKeyboardKit/Sources/View/AIQueryView.swift` - AI查询视图

### 2. 修改文件
- `Packages/HamsterKeyboardKit/Sources/View/KeyboardToolbarView.swift` - 添加AI按钮和AI查询视图集成

## 功能实现

### 1. AI按钮
- 位置：工具栏左侧第一个按钮
- 图标：使用系统 `brain` 图标
- 功能：点击切换AI查询视图的显示/隐藏

### 2. AI查询视图 (AIQueryView)
包含以下元素：
- **文本输入框**：用户输入查询问题
- **查询按钮**：发送HTTP POST请求到 `https://www.qingmiao.cloud/userapi/knowledge/chatNew`
- **响应显示框**：显示AI响应结果，最多10行，超出显示"..."
- **插入按钮**：将AI响应内容插入到当前文本输入位置
- **重新生成按钮**：重新发送相同的查询请求

### 3. 布局结构
- AI查询视图位于工具栏上方
- 高度为200px（展开时）
- 具有动画效果的显示/隐藏切换

## 日志记录
所有关键操作都添加了详细的日志记录：
- 视图初始化
- 用户交互事件
- HTTP请求和响应
- 错误处理

## 测试建议

1. **基本功能测试**
   - 点击AI按钮，确认AI查询视图正常显示/隐藏
   - 在查询框输入文本，点击查询按钮
   - 验证HTTP请求发送和响应处理

2. **界面测试**
   - 确认AI按钮在工具栏左侧正确显示
   - 验证AI查询视图在工具栏上方正确显示
   - 测试动画效果是否流畅

3. **功能测试**
   - 测试插入功能是否正确将AI响应插入到文本
   - 测试重新生成功能是否正常工作
   - 验证10行限制和"..."显示

## 注意事项

1. **网络权限**：确保应用有网络访问权限
2. **API响应格式**：当前代码支持多种响应格式（content、answer、result字段）
3. **错误处理**：包含网络错误、解析错误等各种异常情况的处理
4. **性能优化**：使用了适当的约束和动画优化用户体验

## 编译状态
✅ 语法检查通过
✅ 代码结构完整
✅ 日志记录完善
✅ 错误处理健全